# =============================================================================
# IAM Platform - Шаблон переменных окружения
# =============================================================================
# Скопируйте этот файл в .env и настройте значения
# cp env.example .env
# =============================================================================

# -----------------------------------------------------------------------------
# РЕЖИМ РАБОТЫ ПЛАТФОРМЫ
# -----------------------------------------------------------------------------
# Значения: "dev" или "prod"
# dev  - HTTP, Keycloak в режиме разработки, COOKIE_SECURE=false
# prod - Готовность к HTTPS, Keycloak в production режиме, COOKIE_SECURE=true
ENV=dev

# -----------------------------------------------------------------------------
# ДОМЕН И СЕТЬ
# -----------------------------------------------------------------------------
# Основной домен платформы (без протокола)
# Dev: localhost или 127.0.0.1
# Prod: ваш реальный домен (example.com)
DOMAIN=localhost

# Порт HTTP (для dev режима или редиректа в prod)
HTTP_PORT=5056

# Порт HTTPS (для prod режима)
HTTPS_PORT=5057

# Порт Keycloak (для dev режима, в prod доступ через nginx)
KEYCLOAK_PORT=5058

# -----------------------------------------------------------------------------
# KEYCLOAK - Identity Provider
# -----------------------------------------------------------------------------
# URL Keycloak (внутренний для Docker-сети)
KEYCLOAK_INTERNAL_URL=http://keycloak:8080

# URL Keycloak (внешний для браузера)
# Dev: http://localhost:5058
# Prod: https://auth.example.com
KEYCLOAK_EXTERNAL_URL=http://localhost:5058

# Realm для приложений платформы
KEYCLOAK_REALM=platform

# Учетные данные администратора Keycloak
# ВАЖНО: Измените в production!
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin_secret_change_me

# База данных Keycloak
KC_DB=postgres
KC_DB_URL=jdbc:postgresql://postgres:5432/keycloak
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=keycloak_db_password_change_me

# Режим Keycloak
# Dev: start-dev
# Prod: start (требует настроенный HTTPS)
KC_START_MODE=start-dev

# -----------------------------------------------------------------------------
# OAUTH2-PROXY - Authentication Proxy
# -----------------------------------------------------------------------------
# Client ID и Secret из Keycloak (создаются при импорте realm)
OAUTH2_CLIENT_ID=oauth2-proxy
OAUTH2_CLIENT_SECRET=oauth2_proxy_secret_change_me

# Cookie секрет (РОВНО 32 символа ASCII)
# Сгенерируйте: openssl rand -hex 16 (или любые 32 символа)
OAUTH2_COOKIE_SECRET=0123456789abcdef0123456789abcdef

# Cookie настройки
# Dev: false (HTTP)
# Prod: true (HTTPS)
COOKIE_SECURE=false

# Имя cookie
COOKIE_NAME=_oauth2_proxy

# Домен cookie (должен начинаться с точки для поддоменов)
# Dev: localhost
# Prod: .example.com
COOKIE_DOMAIN=localhost

# -----------------------------------------------------------------------------
# REDIS - Session Storage
# -----------------------------------------------------------------------------
# URL Redis для хранения сессий OAuth2-Proxy
REDIS_URL=redis://redis:6379

# Пароль Redis (опционально, но рекомендуется для prod)
REDIS_PASSWORD=redis_password_change_me

# -----------------------------------------------------------------------------
# POSTGRESQL - База данных Keycloak
# -----------------------------------------------------------------------------
POSTGRES_DB=keycloak
POSTGRES_USER=keycloak
POSTGRES_PASSWORD=keycloak_db_password_change_me

# -----------------------------------------------------------------------------
# NGINX - Reverse Proxy
# -----------------------------------------------------------------------------
# Путь к SSL сертификатам (для prod)
SSL_CERT_PATH=/etc/nginx/ssl/cert.pem
SSL_KEY_PATH=/etc/nginx/ssl/key.pem

# Размер буфера для больших заголовков (Keycloak tokens)
PROXY_BUFFER_SIZE=128k

# -----------------------------------------------------------------------------
# ПРИМЕРЫ ПРИЛОЖЕНИЙ (для тестирования)
# -----------------------------------------------------------------------------
# Демо-приложение 1 (Docker)
APP1_NAME=app1
APP1_DOMAIN=app1.localhost
APP1_UPSTREAM=demo-app1:80
APP1_ALLOWED_GROUPS=admins,app1-users

# Демо-приложение 2 (хост-сервис)
APP2_NAME=app2
APP2_DOMAIN=app2.localhost
APP2_UPSTREAM=host.docker.internal:3000
APP2_ALLOWED_GROUPS=admins,app2-users

# -----------------------------------------------------------------------------
# ЛОГИРОВАНИЕ
# -----------------------------------------------------------------------------
# Уровень логов (debug, info, warn, error)
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# БЕЗОПАСНОСТЬ (для production)
# -----------------------------------------------------------------------------
# Список доверенных IP для заголовков X-Forwarded-*
TRUSTED_PROXIES=172.16.0.0/12,192.168.0.0/16

# Rate limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=1m
