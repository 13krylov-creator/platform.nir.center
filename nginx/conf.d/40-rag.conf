# =============================================================================
# Приложение: Документы
# Создано автоматически: 2026-01-26T09:10:30.038138
# Upstream: http://10.109.50.250:5111
# =============================================================================

server {
    listen 80;
    listen [::]:80;
    
    server_name rag.localhost rag.nir.center;
    
    access_log /var/log/nginx/rag-access.log auth;
    error_log /var/log/nginx/rag-error.log warn;
    
    # OAuth2-Proxy endpoints
    include /etc/nginx/snippets/oauth2-proxy.conf;
    
    # Основной location
    location / {
        include /etc/nginx/snippets/auth.conf;
        
        # RBAC: доступ только для групп: admins|app1-users
        # if ($auth_groups !~ "admins|app1-users") {
        #     return 403;
        # }
        
        proxy_pass http://10.109.50.250:5111;
        include /etc/nginx/snippets/proxy-params.conf;
    }
    
    # Health check (без аутентификации)
    location /health {
        proxy_pass http://10.109.50.250:5111/health;
        include /etc/nginx/snippets/proxy-params.conf;
        access_log off;
    }
}
